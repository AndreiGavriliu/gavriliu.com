[{"body":"","link":"https://gavriliu.com/tags/apt/","section":"tags","tags":null,"title":"Apt"},{"body":"In an effort to balance power efficiency with my tendency to hoard old hardware, I decided to move my overpowered Pi-hole setup from a Mac Mini to a Raspberry Pi 2. (Yes, the Pi 2! A true relic from the past, but still kicking.)\nEverything was going smoothly — static IP, hostname set, network configured — until I ran the inevitable:\nThe problem 1apt update 1Hit:1 http://raspbian.raspberrypi.com/raspbian bookworm InRelease 2Hit:2 http://archive.raspberrypi.com/debian bookworm InRelease 3Reading package lists... Done 4Building dependency tree... Done 5Reading state information... Done 690 packages can be upgraded. Run \u0026#39;apt list --upgradable\u0026#39; to see them. 7W: http://raspbian.raspberrypi.com/raspbian/dists/bookworm/InRelease: Key is stored in legacy trusted.gpg keyring (/etc/apt/trusted.gpg), see the DEPRECATION section in apt-key(8) for details. Weird, it's a brand new install, but anyway, let's fix it.\nThe fix Step 1: Find the Offending Key 1apt-key list | grep -A4 \u0026#34;trusted.gpg$\u0026#34; You'll get something like this:\n1Warning: apt-key is deprecated. Manage keyring files in trusted.gpg.d instead (see apt-key(8)). 2/etc/apt/trusted.gpg 3-------------------- 4pub rsa2048 2012-04-01 [SC] 5 A0DA 38D0 D76E 8B5D 6388 7281 9165 938D 90FD DD2E 6uid [ unknown] Mike Thompson (Raspberry Pi Debian armhf ARMv6+VFP) \u0026lt;mpthompson@gmail.com\u0026gt; That long hex string at the bottom? That's our culprit. Grab the last 8 characters (e.g., 90FDDD2E).\nStep 2: Export the Key to a Temporary File 1apt-key export 90FDDD2E | sudo gpg --dearmor -o /tmp/raspberrypi-os.gpg If you're getting a warning about apt-key being deprecated — yes, we know. Thanks for the reminder, apt.\nStep 3: Verify the Exported Key\n1file /tmp/raspberrypi-os.gpg You should see something like:\n1/tmp/raspberrypi-os.gpg: PGP/GPG key public ring (v4) created Sun Jun 17 15:49:51 2012 RSA (Encrypt or Sign) 2048 bits MPI=0xabc2a41a70625f9f... If this checks out, we’re good to move on.\nStep 4: Delete the Old Key 1apt-key del 90FDDD2E Step 5: Move the Exported Key to the Right Place 1mv /tmp/raspberrypi-os.gpg /etc/apt/trusted.gpg.d/ The Moment of Truth Time to see if all this work actually made a difference.\n1apt update No errors? No legacy key warnings? Success!\nNow, for the real prize:\n1apt upgrade -y Watch those packages roll in, knowing you’ve successfully outwitted a deprecated key storage issue on a nearly decade-old Raspberry Pi.\nThis was one of those “why is this happening on a clean install?” moments that make homelabbing so much fun (and sometimes maddening). But at least now, my Pi-hole setup is running on a true low-power device, and I got a free lesson in Debian’s ever-evolving key management system.\nHope this helps someone else avoid the same head-scratching moment!\n","link":"https://gavriliu.com/post/2025/03/31/fix-key-stored-in-legacy-trusted-gpg-keyring/","section":"post","tags":["apt","gpg","keyring","legacy"],"title":"Fix Key Stored in Legacy Trusted Gpg Keyring"},{"body":"","link":"https://gavriliu.com/","section":"","tags":null,"title":"gavriliu.com"},{"body":"","link":"https://gavriliu.com/tags/gpg/","section":"tags","tags":null,"title":"Gpg"},{"body":"","link":"https://gavriliu.com/series/homelab/","section":"series","tags":null,"title":"Homelab"},{"body":"","link":"https://gavriliu.com/tags/keyring/","section":"tags","tags":null,"title":"Keyring"},{"body":"","link":"https://gavriliu.com/tags/legacy/","section":"tags","tags":null,"title":"Legacy"},{"body":"","link":"https://gavriliu.com/post/","section":"post","tags":null,"title":"Posts"},{"body":"","link":"https://gavriliu.com/series/","section":"series","tags":null,"title":"Series"},{"body":"","link":"https://gavriliu.com/tags/","section":"tags","tags":null,"title":"Tags"},{"body":"","link":"https://gavriliu.com/series/homeassistant/","section":"series","tags":null,"title":"Homeassistant"},{"body":"","link":"https://gavriliu.com/tags/homeassistant/","section":"tags","tags":null,"title":"Homeassistant"},{"body":"A few days ago, my wife decided that we - sorry, I — needed to rearrange our kid's room. This involved unplugging various things, including my IKEA VINDSTYRKA air quality sensor.\nFast forward to today: I noticed my zigbee2mqtt container had been restarting multiple times. Weird.\nBut everything seemed to be working fine — devices were updating, automations were triggering, life was good. Then I plugged the sensor back in, and... Home Assistant didn’t recognize it. Did I forget to pair it after playing around with it? Who knows. But no problem, right? Just press the button four times and let the magic happen.\nWell, magic didn't happen. Instead, my zigbee2mqtt container restarted. Uh-oh.\nThe Troubleshooting Rabbit Hole At this point, I had a feeling something was off. So I tried the usual troubleshooting steps:\nRestarted my SLZB-06M Zigbee coordinator (connected via Ethernet). Restarted the zigbee2mqtt and mqtt containers. Tried to rejoin the sensor again. Same result. Failure. Logs weren’t helpful, just cryptic messages from the Zigbee underworld.\n1Using \u0026#39;/app/data\u0026#39; as data directory 2Starting Zigbee2MQTT without watchdog. 3[2025-03-28 09:30:49] info: z2m: Logging to console, file (filename: log.log) 4[2025-03-28 09:30:49] info: z2m: Starting Zigbee2MQTT version 2.1.3 (commit #ba337bd329aeb4ca17735c0cf09b31293c8cff06) 5[2025-03-28 09:30:49] info: z2m: Starting zigbee-herdsman (3.2.7) 6[2025-03-28 09:30:49] info: zh:ember: Using default stack config. 7[2025-03-28 09:30:49] info: zh:ember: ======== Ember Adapter Starting ======== 8[2025-03-28 09:30:49] info: zh:ember:ezsp: ======== EZSP starting ======== 9[2025-03-28 09:30:49] info: zh:ember:uart:ash: ======== ASH Adapter reset ======== 10[2025-03-28 09:30:49] info: zh:ember:uart:ash: Socket ready 11[2025-03-28 09:30:49] info: zh:ember:uart:ash: ======== ASH starting ======== 12[2025-03-28 09:30:51] info: zh:ember:uart:ash: ======== ASH connected ======== 13[2025-03-28 09:30:51] info: zh:ember:uart:ash: ======== ASH started ======== 14[2025-03-28 09:30:51] info: zh:ember:ezsp: ======== EZSP started ======== 15[2025-03-28 09:30:51] info: zh:ember: Adapter EZSP protocol version (14) lower than Host. Switched. 16[2025-03-28 09:30:51] info: zh:ember: Adapter version info: {\u0026#34;ezsp\u0026#34;:14,\u0026#34;revision\u0026#34;:\u0026#34;8.0.2 [GA]\u0026#34;,\u0026#34;build\u0026#34;:397,\u0026#34;major\u0026#34;:8,\u0026#34;minor\u0026#34;:0,\u0026#34;patch\u0026#34;:2,\u0026#34;special\u0026#34;:0,\u0026#34;type\u0026#34;:170} 17[2025-03-28 09:30:51] info: zh:ember: [STACK STATUS] Network up. 18[2025-03-28 09:30:52] info: zh:ember: [INIT TC] Adapter network matches config. 19[2025-03-28 09:30:52] info: zh:ember: [CONCENTRATOR] Started source route discovery. 1246ms until next broadcast. 20[2025-03-28 09:30:52] info: z2m: zigbee-herdsman started (resumed) 21[...] 22[2025-03-28 09:22:37] info: zh:controller: Interview for \u0026#39;0xd44867fffe5b1c0c\u0026#39; started 23[2025-03-28 09:22:37] info: z2m: Device \u0026#39;0xd44867fffe5b1c0c\u0026#39; joined 24[2025-03-28 09:22:37] info: z2m: Starting interview of \u0026#39;0xd44867fffe5b1c0c\u0026#39; 25[2025-03-28 09:22:37] info: z2m:mqtt: MQTT publish: topic \u0026#39;zigbee2mqtt/bridge/event\u0026#39;, payload \u0026#39;{\u0026#34;data\u0026#34;:{\u0026#34;friendly_name\u0026#34;:\u0026#34;0xd44867fffe5b1c0c\u0026#34;,\u0026#34;ieee_address\u0026#34;:\u0026#34;0xd44867fffe5b1c0c\u0026#34;},\u0026#34;type\u0026#34;:\u0026#34;device_joined\u0026#34;}\u0026#39; 26[2025-03-28 09:22:37] info: z2m:mqtt: MQTT publish: topic \u0026#39;zigbee2mqtt/bridge/event\u0026#39;, payload \u0026#39;{\u0026#34;data\u0026#34;:{\u0026#34;friendly_name\u0026#34;:\u0026#34;0xd44867fffe5b1c0c\u0026#34;,\u0026#34;ieee_address\u0026#34;:\u0026#34;0xd44867fffe5b1c0c\u0026#34;,\u0026#34;status\u0026#34;:\u0026#34;started\u0026#34;},\u0026#34;type\u0026#34;:\u0026#34;device_interview\u0026#34;}\u0026#39; 27[2025-03-28 09:22:37] error: zh:ember:uart:ash: Received ERROR from adapter, with code=ERROR_EXCEEDED_MAXIMUM_ACK_TIMEOUT_COUNT. 28[2025-03-28 09:22:37] error: zh:ember:uart:ash: ASH disconnected | Adapter status: ASH_NCP_FATAL_ERROR 29[2025-03-28 09:22:37] error: zh:ember:uart:ash: Error while parsing received frame, status=ASH_NCP_FATAL_ERROR. 30[2025-03-28 09:22:37] error: zh:ember: Adapter fatal error: HOST_FATAL_ERROR 31[2025-03-28 09:22:37] info: zh:ember:uart:ash: ASH COUNTERS since last clear: 32[2025-03-28 09:22:37] info: zh:ember:uart:ash: Total frames: RX=92, TX=134 33[2025-03-28 09:22:37] info: zh:ember:uart:ash: Cancelled : RX=0, TX=0 34[2025-03-28 09:22:37] info: zh:ember:uart:ash: DATA frames : RX=72, TX=41 35[2025-03-28 09:22:37] info: zh:ember:uart:ash: DATA bytes : RX=1284, TX=501 36[2025-03-28 09:22:37] info: zh:ember:uart:ash: Retry frames: RX=17, TX=0 37[2025-03-28 09:22:37] info: zh:ember:uart:ash: ACK frames : RX=0, TX=91 38[2025-03-28 09:22:37] info: zh:ember:uart:ash: NAK frames : RX=0, TX=0 39[2025-03-28 09:22:37] info: zh:ember:uart:ash: nRdy frames : RX=0, TX=0 40[2025-03-28 09:22:37] info: zh:ember:uart:ash: CRC errors : RX=0 41[2025-03-28 09:22:37] info: zh:ember:uart:ash: Comm errors : RX=0 42[2025-03-28 09:22:37] info: zh:ember:uart:ash: Length \u0026lt; minimum: RX=0 43[2025-03-28 09:22:37] info: zh:ember:uart:ash: Length \u0026gt; maximum: RX=0 44[2025-03-28 09:22:37] info: zh:ember:uart:ash: Bad controls : RX=0 45[2025-03-28 09:22:37] info: zh:ember:uart:ash: Bad lengths : RX=0 46[2025-03-28 09:22:37] info: zh:ember:uart:ash: Bad ACK numbers : RX=0 47[2025-03-28 09:22:37] info: zh:ember:uart:ash: Out of buffers : RX=0 48[2025-03-28 09:22:37] info: zh:ember:uart:ash: Retry dupes : RX=17 49[2025-03-28 09:22:37] info: zh:ember:uart:ash: Out of sequence : RX=0 50[2025-03-28 09:22:37] info: zh:ember:uart:ash: ACK timeouts : RX=0 51[2025-03-28 09:22:37] error: zh:ember:uart:ash: Error while parsing received frame, status=ASH_NCP_FATAL_ERROR. 52[2025-03-28 09:22:37] info: zh:ember:uart:ash: ======== ASH stopped ======== 53[2025-03-28 09:22:37] info: zh:ember:ezsp: ======== EZSP stopped ======== 54[2025-03-28 09:22:37] info: zh:ember: ======== Ember Adapter Stopped ======== 55[2025-03-28 09:22:37] error: z2m: Adapter disconnected, stopping 56[2025-03-28 09:22:49] info: z2m:mqtt: MQTT publish: topic \u0026#39;zigbee2mqtt/bridge/state\u0026#39;, payload \u0026#39;{\u0026#34;state\u0026#34;:\u0026#34;offline\u0026#34;}\u0026#39; 57[2025-03-28 09:22:49] info: z2m: Disconnecting from MQTT server 58[2025-03-28 09:22:49] info: z2m: Stopping zigbee-herdsman... 59[2025-03-28 09:22:49] info: z2m: Stopped zigbee-herdsman 60[2025-03-28 09:22:49] info: z2m: Stopped Zigbee2MQTT Turning to the Internet (And Realizing No One Had a Fix) Like any responsible tech enthusiast, I turned to the Internet — GitHub issues, forums, random Reddit threads. And, as expected, I found discussions, but none of the solutions worked for me. Some people suggested downgrading firmware, others said to sacrifice a goat (or was it just reset the Zigbee network? Hard to tell).\nThe Fix That Worked Since nothing else was helping, I decided to go nuclear: flash the firmware. Here’s what I did:\nFlashed the Zigbee Router 20250220 firmware. Flashed the Zigbee Coordinator 20250220 firmware. And boom! Everything was back to normal. The sensor paired without issues, no more zigbee2mqtt restarts, and my smart home was happy again.\nLessons Learned Never underestimate the chaos a simple room rearrangement can cause. When in doubt, firmware flashing is sometimes the way to go. Maybe keep a backup Zigbee coordinator handy? (Future me, take note.) Hopefully, this helps someone avoid spending hours chasing ghost issues. If you're dealing with zigbee2mqtt restarting when adding a device, give firmware flashing a shot. Just, you know, be careful not to brick your hardware.\nHappy Zigbee-ing!\n","link":"https://gavriliu.com/post/2025/03/28/how-rearranging-a-kid-s-room-broke-my-zigbee-network-and-how-i-fixed-it/","section":"post","tags":["zigbee2mqtt","slzb-06m","troubleshoot","homeassistant"],"title":"How Rearranging a Kid's Room Broke My Zigbee Network (and How I Fixed It)"},{"body":"","link":"https://gavriliu.com/tags/slzb-06m/","section":"tags","tags":null,"title":"Slzb-06m"},{"body":"","link":"https://gavriliu.com/tags/troubleshoot/","section":"tags","tags":null,"title":"Troubleshoot"},{"body":"","link":"https://gavriliu.com/tags/zigbee2mqtt/","section":"tags","tags":null,"title":"Zigbee2mqtt"},{"body":"Sometimes, I totally forget to take out the garbage bins. And around here, the rule is simple: if your bins aren’t on the sidewalk, the garbage truck just cruises by like a VIP limo ignoring peasants.\nWhen we first moved in, I forgot to take out the recycling bags (Gelber Sack) three times in a row. This resulted in a majestic mountain of 25 bags filled with plastic, empty cat food cans, and my dignity.\nTo avoid turning my house into a landfill, I’m using the Waste Collection Schedule via HACS. Since I like keeping my data and my trash collection local, I downloaded the ICS file from the city’s waste management service and share it through a filebrowser container so Home Assistant can grab it.\nNow, I have three trusty sensor entities keeping me on track:\nsensor.restabfall sensor.gelber_sack sensor.papier configuration.yaml 1waste_collection_schedule: 2 sources: 3 - name: ics 4 args: 5 url: !secret waste_collection_ics_url 6 offset: 0 7 calendar_title: Waste Collection sensors.yaml 1- platform: waste_collection_schedule 2 name: Restabfall 3 value_template: \u0026#34;{% if value.daysTo == 0 %}Today{% elif value.daysTo == 1 %}Tomorrow{% else %}in {{value.daysTo}} days{% endif %}\u0026#34; 4 types: 5 - Restabfall 6- platform: waste_collection_schedule 7 name: Gelber Sack 8 value_template: \u0026#34;{% if value.daysTo == 0 %}Today{% elif value.daysTo == 1 %}Tomorrow{% else %}in {{value.daysTo}} days{% endif %}\u0026#34; 9 types: 10 - Gelber Sack 11- platform: waste_collection_schedule 12 name: Papier 13 value_template: \u0026#34;{% if value.daysTo == 0 %}Today{% elif value.daysTo == 1 %}Tomorrow{% else %}in {{value.daysTo}} days{% endif %}\u0026#34; 14 types: 15 - Papier Cards Armed with the mystical powers of card-mod, the sorcery of mushroom-entity-card, and the sheer chaos of a well-placed grid, I conjured up the following magical creation:\n1square: false 2columns: 3 3type: grid 4cards: 5 - type: custom:mushroom-entity-card 6 entity: sensor.restabfall 7 tap_action: 8 action: none 9 hold_action: 10 action: none 11 double_tap_action: 12 action: none 13 icon_type: none 14 fill_container: false 15 layout: vertical 16 card_mod: 17 style: | 18 ha-card { 19 background-color: 20 {% if is_state(\u0026#39;sensor.restabfall\u0026#39;, \u0026#39;in 2 days\u0026#39;) %} 21 #FFE4B5 22 {% elif is_state(\u0026#39;sensor.restabfall\u0026#39;, \u0026#39;Tomorrow\u0026#39;) %} 23 #FA8072 24 {% else %} 25 #FFFFFF 26 {% endif %} 27 } 28 - type: custom:mushroom-entity-card 29 entity: sensor.gelber_sack 30 tap_action: 31 action: none 32 icon_type: none 33 layout: vertical 34 hold_action: 35 action: none 36 double_tap_action: 37 action: none 38 card_mod: 39 style: | 40 ha-card { 41 background-color: 42 {% if is_state(\u0026#39;sensor.gelber_sack\u0026#39;, \u0026#39;in 2 days\u0026#39;) %} 43 #FFE4B5 44 {% elif is_state(\u0026#39;sensor.gelber_sack\u0026#39;, \u0026#39;Tomorrow\u0026#39;) %} 45 #FA8072 46 {% else %} 47 #FFFFFF 48 {% endif %} 49 } 50 - type: custom:mushroom-entity-card 51 entity: sensor.papier 52 tap_action: 53 action: none 54 icon_type: none 55 layout: vertical 56 hold_action: 57 action: none 58 double_tap_action: 59 action: none 60 card_mod: 61 style: | 62 ha-card { 63 background-color: 64 {% if is_state(\u0026#39;sensor.papier\u0026#39;, \u0026#39;in 2 days\u0026#39;) %} 65 #FFE4B5 66 {% elif is_state(\u0026#39;sensor.papier\u0026#39;, \u0026#39;Tomorrow\u0026#39;) %} 67 #FA8072 68 {% else %} 69 #FFFFFF 70 {% endif %} 71 } 72grid_options: 73 columns: 12 74 rows: auto ","link":"https://gavriliu.com/post/2025/03/14/waste-collection-schedule-in-ha/","section":"post","tags":["homeassistant","waste-collection"],"title":"Waste Collection Schedule in HomeAssistant"},{"body":"","link":"https://gavriliu.com/tags/waste-collection/","section":"tags","tags":null,"title":"Waste-Collection"},{"body":"Shoutout to derekbit for saving my cluster from a tragic post-power-outage existential crisis. My entire homelab went down for a few hours, and Longhorn wasn’t exactly in a hurry to come back. More details on the saga can be found here and in this lifesaving comment.\nTools used stern: Stern allows you to tail multiple pods on Kubernetes and multiple containers within the pod. Each result is color coded for quicker debugging. Check the logs To start questioning your life choices, run:\n1stern -n longhorn-system longhorn-manager This will flood your terminal with comforting messages like:\n1longhorn-manager-brgwp longhorn-manager E0129 16:59:30.764472 1 share_manager_controller.go:254] failed to sync longhorn-system/pvc-ca4a891c-cdc9-424e-949d-0ea016b80c84: pod share-manager-pvc-ca4a891c-cdc9-424e-949d-0ea016b80c84 for share manager not found 2longhorn-manager-brgwp longhorn-manager time=\u0026#34;2024-01-29T16:59:30Z\u0026#34; level=error msg=\u0026#34;Dropping Longhorn share manager out of the queue\u0026#34; func=controller.handleReconcileErrorLogging file=\u0026#34;utils.go:72\u0026#34; ShareManager=longhorn-system/pvc-7da9dfcf-a9b8-4995-ab1d-100a2a9ee72a controller=longhorn-share-manager error=\u0026#34;failed to sync longhorn-system/pvc-7da9dfcf-a9b8-4995-ab1d-100a2a9ee72a: pod share-manager-pvc-7da9dfcf-a9b8-4995-ab1d-100a2a9ee72a for share manager not found\u0026#34; node=hive02 In short: Longhorn was not having a good day.\nApply the fix Borrowing from the wisdom of the Issue thread, I decided to take the nuclear option and reset all my volumes:\n1for lhsm in $(kubectl -n longhorn-system get lhsm --no-headers | awk \u0026#39;{ print $1 }\u0026#39;) 2do 3 kubectl -n longhorn-system patch lhsm $lhsm --type=merge --subresource status --patch \u0026#39;status: {state: error}\u0026#39; 4 sleep 30 5done A few hours (and nervous sweats) later, everything was back to normal. No data loss, just a valuable lesson: Power outages are the devil, and Longhorn likes to hold grudges.\n","link":"https://gavriliu.com/post/2025/03/14/containers-not-mounting-longhorn-volumes/","section":"post","tags":["longhorn","troubleshooting"],"title":"Containers Not Mounting Longhorn Volumes"},{"body":"","link":"https://gavriliu.com/tags/longhorn/","section":"tags","tags":null,"title":"Longhorn"},{"body":"","link":"https://gavriliu.com/tags/troubleshooting/","section":"tags","tags":null,"title":"Troubleshooting"},{"body":"","link":"https://gavriliu.com/tags/application/","section":"tags","tags":null,"title":"Application"},{"body":"","link":"https://gavriliu.com/tags/argocd/","section":"tags","tags":null,"title":"Argocd"},{"body":"I feel pretty dumb right now. I used 2 ArgoCD applications for the same thing—one for my Helm chart, the other for flat manifest YAML files. Apparently, thinking isn’t my strong suit. I mean, I could barely remember where I put my coffee, let alone plan a proper ArgoCD setup!\nSo, like any reasonable person, I had to RTFM (read the fine manual, of course), and eventually stumbled upon the brilliant solution.\n1apiVersion: argoproj.io/v1alpha1 2kind: Application 3metadata: 4 name: kasten 5 namespace: argocd 6spec: 7 destination: 8 server: https://kubernetes.default.svc 9 namespace: kasten-io 10 project: default 11 sources: 12 - repoURL: https://charts.kasten.io 13 chart: k10 14 targetRevision: \u0026#34;7.5.7\u0026#34; 15 helm: 16 valueFiles: 17 - $values/clusters/hive/apps/kasten-io/helm/values.yaml 18 - repoURL: \u0026#39;git@github.com:AndreiGavriliu/homelab.git\u0026#39; 19 targetRevision: main 20 ref: values 21 - repoURL: \u0026#39;git@github.com:AndreiGavriliu/homelab.git\u0026#39; 22 targetRevision: main 23 path: clusters/hive/apps/kasten-io/k8s-manifests 24 syncPolicy: 25 syncOptions: 26 - CreateNamespace=true Look at how simple that was! How did I not think of this sooner? My brain must’ve been on vacation.\n","link":"https://gavriliu.com/post/2025/03/14/argocd-combine-helm-and-k8s-manifests-in-one-application/","section":"post","tags":["argocd","application","helm"],"title":"Combine Helm and K8s Manifests in One ArgoCD Application"},{"body":"","link":"https://gavriliu.com/tags/helm/","section":"tags","tags":null,"title":"Helm"},{"body":"","link":"https://gavriliu.com/tags/bitnami/","section":"tags","tags":null,"title":"Bitnami"},{"body":"I decided to push my Kubernetes manifests to GitHub because running Git locally on the same k3s cluster as ArgoCD seemed like asking for trouble. I mean, what happens if something goes wrong?\nSuddenly, you’re locked out of your repository, and your applications just sit there looking sad, like ‘Hey, I need a home!’ Pushing everything - including secrets — straight to GitHub? That’s like sending your passwords in a postcard: ‘Hey, here’s all my private stuff for the world to see!’ So, I decided to use Bitnami’s Sealed Secrets. At least now, my secrets are sealed tighter than my New Year’s resolution to work out!\nWhat are Bitnami’s Sealed Secrets? Problem: \u0026quot;I can manage all my K8s config in git, except Secrets.\u0026quot;\nSolution: Encrypt your Secret into a SealedSecret, which is safe to store - even inside a public repository. The SealedSecret can be decrypted only by the controller running in the target cluster and nobody else (not even the original author) is able to obtain the original Secret from the SealedSecret. (from the official project's GitHub Repository)\nYou might be wondering what it actually looks like\nHow to seal secrets Sensitive information For instance, if you need to seal the following credentials:\nPOSTGRES_HOST: 10.20.1.45 POSTGRES_PORT: 5432 POSTGRES_DB: fbi_undercover_agents POSTGRES_USER: admin POSTGRES_PASSWORD: superSecr3tPassw0rd Create a secret The values of each key in secret.yaml must be base64 encoded\n1apiVersion: v1 2kind: Secret 3metadata: 4 name: fbi-agents 5 namespace: fbi 6data: 7 POSTGRES_HOST: MTAuMjAuMS40NQ== 8 POSTGRES_PORT: NTQzMg== 9 POSTGRES_DB: ZmJpX3VuZGVyY292ZXJfYWdlbnRz 10 POSTGRES_USER: YWRtaW4= 11 POSTGRES_PASSWORD: c3VwZXJTZWNyM3RQYXNzdzByZA== Seal the secret 1cat secret.yaml | kubeseal \\ 2 --controller-name=sealed-secrets \\ 3 --controller-namespace=sealed-secrets \\ 4 --format=yaml \\ 5 --scope=cluster-wide \u0026gt; sealed-secret.yaml --controller-name: Name of sealed-secrets controller. (default \u0026quot;sealed-secrets-controller\u0026quot;). Since I installed via helm, the controller name is sealed-secrets --controller-namespace: Namespace of sealed-secrets controller. (default \u0026quot;kube-system\u0026quot;) --format: Output format for sealed secret. Either json or yaml (default \u0026quot;json\u0026quot;) --scope: Set the scope of the sealed secret: strict, namespace-wide, cluster-wide (defaults to strict). Mandatory for --raw, otherwise the sealedsecrets.bitnami.com/cluster-wide and sealedsecrets.bitnami.com/namespace-wide annotations on the input secret can be used to select the scope. (default strict) This generates the file sealed-secret.yaml\nCheck the sealed secret file Check metadata.name, metadata.namespace, spec.template.metadata.name and spec.template.metadata.namespace are correct. Ensure these match your intended Secret deployment to avoid issues when applying the SealedSecret\n1apiVersion: bitnami.com/v1alpha1 2kind: SealedSecret 3metadata: 4 annotations: 5 sealedsecrets.bitnami.com/cluster-wide: \u0026#34;true\u0026#34; 6 creationTimestamp: null 7 name: fbi-agents 8 namespace: fbi 9spec: 10 encryptedData: 11 POSTGRES_DB: AgCimSDyG7/fDlP9f6lLjr1iVfL2UDcOYsrdkGAUipqIMO+Nd9/aVokfWVveKqAmF0ZFx1tDp2BO8YGv54A7oJVKCiLE3EYVMcsAa76Q3IrUtfbY3Qp5Kk9dLP0IuDn8zykZqpG4RSYqC4ZT+9hnaPRDp+BoeQysJJEoL5txyr/b39LbkUXmH/fuwbHT8ZmYZ7p1wkBxRVKL6vXnqO0GEYi9X8wxBw2ptQuvrt/JD9VUPByLoJTvqLXMfkGcnJ3Is6l5S54vU5Z9HQIodVSVBI34o1WUcP48K1Kj96MXvJ2UgremjmgNgFmrpc0T2cLsIIMAPhWj8g2KTDy2aB5zW2P48wVNW7Uu0foAP9rXgybPexSSA52Vv06ZYwED9zzVQJvvZlAt0Q78+7goB8MzlsU31R4LDs2FcKV1uxATKau+CKe+kKhAN/GBI+vLaLFHdmVIDdmNT3jIapoY00iFL9Xcrv7GdecWrMrov3ZC2co//1E2eZnb+aX71Jl9riYCNXP7J/TXlGc+LcQ4RPxQyWfJ8/r83MipMTfB+iqUjuvOTgVE/5Qf2HtU/1HPWOHgmGJTmiglyRYeLLzug45NBTeFimcIX/2JwqTJwF/sHcdqwu/iotNHNmYf1O/vbjIeWgHFVX8DqtZ/j/0G6zTWPBdEE0tcuKwwvGwYzhcQgj4SjVb9NoYpzkXZXH/p2NXHSnIIBcEynwsNphx71Q9FjtEkGCax5OQ= 12 POSTGRES_HOST: AgBQFZiZaZCeRVzWqAqOaxGuoSRAGPHmITd6XvW5K0NTvA8ZE+yrheKK4sQHS7htQQeFzBOEz99GrRxNLmhQbMDgA0GGd7qCm/kGsVEpNcf8C8yJ6KzRlCCyQdP9PcOIjwAvPxpisGJvStobcsxQXl9VWlCh/4VpkWED7JYJh8TlYd0XaXMR2i+6Q581C3cVPUH0V07EUPiPxstI4w18l8HqAfFqKZiT+uk9EsVXl/IPOqg9Dxg/SksrWuY7EP3R1lrubzQr+RM02LInw5cLh6iX9x3ZNiuF3BbnKKDgA5/tT1+qOP4bljE2JwHMOdo1oJZnrvw2ny4/x9nKOzkAa8KjogSTdFonDnlBV0bRXZ4G3RSZPNcp9l2TG5Q7itZNX1WcOMa+o5OJQUsVf6Y6aSTr+QB1LxeCk8tASPsu1HnaZSSzECr3fxMJ1gDRz6l8SFHLM9XQ0j9MN6QrnNSmWOUWnhAsa22uX+nYM43jGm6oELrlXo/fNLn0oPuY2xaKpO+5YNZ3AM+xGFFioPs+e2Hl+gBsXwY4ZmEou7vZ5/mSIVuTMBkmedi/sdhfpYmOwhVXfqsVa7Rh+ov6Ab6zOEC+xEnVmyxclesEY7wHonCNK4M4YiIXQalHo1M0mi4q78HvvXrOSzmqqRWBg3V8R8mwhypgg1aIgkx7Jti1HRqvXb9hg2rFU+R+fx3vnravYmNO4mt3ePs274GZ 13 POSTGRES_PASSWORD: AgCEGEVwbWu4GeNgqJDWPO+XgdsMj5j5vMguARiMLFIEz3asEqETItVqMoY+TaF4Cb0jQ51SuhpQYQwy/0LBJbriy9Nj/YxHEBg9q2M11kkd15S4Lwrnan44PiLKYwLjkpM5GkzHek60eT56MxeT2O4gX9muGfYvRle5W71eGba2JMktu8ERXnMStulOUf0Oqfx4DCD7YRgvhsdlFqBMLs9uAcefrXkWjXKuyJhkIdFJBIS9JLjbw68DyQXPWmwHTAbhXWetKIQHYAe+Yr//VZUolAfeqb7xW2NwcLr5WKrdbk9fHgxWKUwPP6KpcmlF2MlwJbntEzOF6ZYBy9IY1Gw4XEu+4ayT8KXYTK8y1gXzBgbFUINs0YNlJoxK7XMIcTj3gBCpg2e4cPHolBpi7bGhAuHJ5vh7d9HZ4KhhxXqcbQ6cin/V5zEK91okpFUyBtiZphlFWJTcgwnaqGbvuCTuh7XHYTEUKWaE+1ha4PV0qLqHzz9d6P2/lobYZyJ+xsczwrdaUyKz7/WgHlDk4Y/xy79ZL9xIOTyUYymEwrzgO2mSN3PAof87ryTM49cpQZd25BxtSa1Y/asYmd6FrpHdaQmxMndAPATugSp4t3XJoKpCVn7+JN4K5dEawAqJyKVqoB/8URcjHnPcgx/Fp4LOJ919WvmR/+wZpjx3eFnOC/+QOqE3H/DzPVhVwsOOUWWbktS2rHM0afy8YATqRI6W8Eja 14 POSTGRES_PORT: AgAOH0MigGUSP2Dh88jMdLV0aFURvlYNM9OChDHCeZSSELa0vnAR7f4rAMLQhO00EupMZj+EcVozXTY2ZoB8u1PKC0/WxjoHTvzHARwFHGMW/SjZFw4YXsBP8lIcFz0aHIHQcGE/vkF0KYPOgH3Gi9r7x3zT8bpHaDrSWtgcsw2Ijzx5bidBcvuGIPfi4R6bMrZxBhz1F+/AY360IVRwXxluCVoXmb+2X2Bp01XqAk2f6fh4dQDz9G+kDyvV7O0eW5KxLqmYHME+AzpEq+M7zE1xlPzE6vb1TB7DOJBBeeejGu/Iq3Yx26D8jAoSAMHsj4kPKEiYTwYZ0mbq6H789MYnnn/PIOkPHqo/2i6lHwJbxoAkGzIkBI6wKZGP5um1PCJFJv2n2DPMEDsTlxkL8j1l0TI607R00jJ5gc7f7Czepi+BXhyadn+wbnmEu/7yAEO13uKNa8M4DKcKUzuTFg/PghjLjK8PnUw14NdAcP8XjEvWtqtjo4QkPFsalAUmvEYZEODol0DiaG0jT50d8IYgXp6Hx5qlC1L1g0p3xPrO6QH8BVda8h/NePISB4rBo/PmQgvz1GyTRSgs14stt1RsjNAKzpNBACysCY0+MNpeAsqg8bLsGkBcl7bfac5HdrY45fR4lS6dIDLlLbW6htEWwBlDeOPX3HznSnnxDvf2ywdakpMzVLsLVII9qmcgDf4riTNo 15 POSTGRES_USER: AgBC8nVi5UKfNCOzMnzGm1GPafXu2TgAYHqlEfCyHD5DA8btqX8dWpbJehUuXhG39qJnrZe/f3vUwpUIWfgTma2+HUfBz71cyUgrrcvY0HczAvzqs8pz34KjeuZF5GD64rkcWgc0aP663F8ANGsFklsq3fsHzY2xH3dFiKukH6b2jLcitwfrhm55JcUtmnHfeGqwMYSj3MXwf49f07E84zdFH5PgImUOoA4KgzdlcnBzzyqutjSF8omTbTcAq4nmjO8Qa3+pN+gjxU5B2ATC6mtYdfO87DXEG60SasnTsWcS9vR9AKH8CpUX1VR/Q72KyJf5DNCSZsXUVm9kag6RC4KAH3P7xUX5OTlTHZkZsGUi0jI7wP6QtxSdQK9E8t7fHuvlBd7oEwdFYo6gOlLFanO8vHbGE1ZeJSYg3Fhl+bCevXnPRBU7xrqhnvg7VG/Ek9ctmjZHGGen/XrDa7cMpExjjVPuW6Ax+MFQmB+tryHwxDSJ0VTzFbax4yJK84iyvqmxai5xdedetAI6ZbQqcCZx/Hn8QfaKLAObEruA2ryBmyOIbo7Ymx5TLb0E8ZaAoPqW3Joa3dBd+OMhCEGZ0ts0CXKqBaIEEPs6rdz78afCd2WAFcCNJgT+KH596Z5OEfg9q3nD/Gs+WN4HKy+M20CkPo19kQlbcnIpTLNY5oSRGJSpvn9lovYvp6kN8ZQnlKtBmaDJfA== 16 template: 17 metadata: 18 annotations: 19 sealedsecrets.bitnami.com/cluster-wide: \u0026#34;true\u0026#34; 20 creationTimestamp: null 21 name: fbi-agents 22 namespace: fbi How to unseal secrets Download sealed secret key 1kubectl get secret \\ 2 -n sealed-secrets \\ 3 -l sealedsecrets.bitnami.com/sealed-secrets-key\u0026lt;uniqueId\u0026gt; \\ 4 -o yaml \u0026gt; sealed-secrets-key.yaml Unseal secret using downloaded key 1kubeseal --controller-name=sealed-secrets \\ 2 --controller-namespace=sealed-secrets \u0026lt; sealed-secret.yaml \\ 3 --recovery-unseal \\ 4 --recovery-private-key=sealed-secrets-key -o yaml ","link":"https://gavriliu.com/post/2025/03/14/how-to-seal-and-unseal-secrets-with-bitnami-sealed-secrets/","section":"post","tags":["bitnami","sealed-secrets","security"],"title":"How to seal and unseal secrets with Bitnami Sealed-Secrets"},{"body":"","link":"https://gavriliu.com/tags/sealed-secrets/","section":"tags","tags":null,"title":"Sealed-Secrets"},{"body":"","link":"https://gavriliu.com/tags/security/","section":"tags","tags":null,"title":"Security"},{"body":"Who? Andrei Gavriliu - Senior IT Consultant | OpenShift @ ConSol Consulting \u0026amp; Solutions Software GmbH\nI’ve been working at ConSol Consulting \u0026amp; Solutions Software GmbH since 2012, solving technical challenges and breaking things just enough to learn how to fix them again. I have a passion for technology, whether it’s bleeding-edge Kubernetes clusters or almost century-old bicycles that somehow still work better than modern ones.\nWhen I’m not in front of a terminal, I attempt downhill riding — with a strong emphasis on attempt — while trying to avoid turning myself into a cautionary tale. Homelabbing, rediscovering old tech, and tinkering with anything that has gears, or a slightly questionable user manual keep me busy.\nIf it’s complex, obscure, or slightly dangerous, I’m probably interested.\nI can’t think of any reason why, but if you want to get in touch with me or follow me, here I am:\nGitHub LinkedIn XING Why? I started this blog because I figured it’s time to share my knowledge and opinions with the world. After all, if it’s on the internet, it must be true… right? Well, apparently not. There’s a ton of outdated info and some outright nonsense out there. Even ChatGPT has its off days — sometimes the info is ancient, and other times it just hits me with the classic 'You’re right!' like I’m talking to a cheerleader instead of getting actual answers. So here I am, doing my part to make the internet a little less… well, internet-y!\nWhat? Here are some of the tools I rely on to keep my homelab running smoothly - no particular order, just pure utility. Each one helps me troubleshoot, automate, or manage my setup with less hassle. Because let’s be honest, a well-managed homelab means fewer late-night debugging sessions!\nansible, argocd, fluxcd, helm, k9s, kubectl, kubectx, kubens, kubeseal, oc, popeye, renovatebot, stern, tmux, velero, vscode\nPrivacy \u0026amp; Data Usage This website values your privacy and only uses local cookies to store your preferences (e.g.: light/dark mode). No third-party tracking cookies or external advertising networks are used.\nFor comments, the site integrates giscus (repository), a GitHub-based commenting system. To participate in discussions, you will need a GitHub account, as all comments are stored as discussions within my repository.\nFor analytics, we use a self-hosted Umami (repository) instance to gather insights on website traffic while respecting user privacy. No personal data is collected, and all analytics data remains within our infrastructure.\nBoth the static site and the analytics service are hosted in my self-managed homelab, ensuring full control over data and performance.\n","link":"https://gavriliu.com/about/","section":"","tags":null,"title":"About"},{"body":"","link":"https://gavriliu.com/categories/","section":"categories","tags":null,"title":"Categories"},{"body":"Homelab My homelab is running on 4 Intel NUCs, all happily chugging along with k3s. The network backbone is a UniFi setup, featuring a UDMPro and a UniFi Switch 24 Pro POE. Right now, it’s a cozy 1GB network, but I’m planning to bump it up to 2.5GB soon—because, well, who doesn’t love faster speeds? The only thing slowing me down at the moment is the backup process—Longhorn and Kasten.io backups are giving me a bit of a bottleneck, with everything stored safely on my trusty old Synology DS918+.\nA few details about what makes it all work smoothly:\nTraefik (Dynamic ingress controller) ArgoCD (GitOps continuous delivery) Kasten.io (Kubernetes backup solution) Longhorn (Cloud-native storage) Bitnami Sealed Secrets (Encrypted secrets management) Graylog (Centralized log management) RenovateBot (Automated dependency updates) MetalLB (Load balancing for bare-metal) cert-manager (TLS certificate management) kube-prometheus-stack (Monitoring stack) Grafana (Data visualization) Prometheus (Metrics collection) AlertManager (Alert management) ... more details about the cluster and what Apps I am hosting, in my homelab series\nHome Assistant Home Assistant is like my home’s personal assistant, but instead of scheduling meetings, it’s reminding me to take the trash out and telling me when the washer’s done. It’s got some quirks, though—sometimes it seems to know me better than I know myself, like when it randomly turns on the lights at 3 AM and I’m left wondering if it’s just being helpful or trying to send me a message. At least it’s not sending passive-aggressive reminders… yet.\nA few integrations I use:\nAlarmo Google Calendar Homematic(IP) Local InfluxDB Nintendo Switch Parental Controls ONVIF OpenWeatherMap OpenWeatherMap History SMLIGHT Tasmota UniFi Network UniFi Protect Waze Travel Time ... more details about my Home Assistant instance and what Integrations I am using, in my homeassistant series\nTasmin I’m building Tasmin — a GitOps-like manager for your Tasmota devices that not only updates, configures, and backs them up, but also checks for changes in the config and corrects them when the devices finally decide to show up on the network. Think of it like TasmoAdmin and TasmoBackup, but with a ‘because I can’ attitude. Powered by FastAPI and a sprinkle of ‘I can do this better… probably’ energy!\nI’m too ashamed of my code right now, so the repository will be posted at a later date… after I make it look like I know what I’m doing.\n","link":"https://gavriliu.com/projects/","section":"","tags":null,"title":"Projects"}]