<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Containers Not Mounting Longhorn Volumes :: Terminal</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Shoutout to derekbit for saving my cluster from a tragic post-power-outage existential crisis. My entire homelab went down for a few hours, and Longhorn wasn’t exactly in a hurry to come back. More details on the saga can be found here and in this lifesaving comment.
Tools used stern: Stern allows you to tail multiple pods on Kubernetes and multiple containers within the pod. Each result is color coded for quicker debugging. Check the logs To start questioning your life choices, run:
" />
<meta name="keywords" content=", " />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="https://hugo.gavriliu.com/posts/containers-not-mounting-longhorn-volumes/" />





  
  <link rel="stylesheet" href="https://hugo.gavriliu.com/css/buttons.min.86f6b4c106b6c6eb690ae5203d36b442c1f66f718ff4e8164fa86cf6c61ad641.css">

  
  <link rel="stylesheet" href="https://hugo.gavriliu.com/css/code.min.4f0ccc8439f99bf7f7970298556b94011aabc1fcae743b6842fc3361a2da9ea3.css">

  
  <link rel="stylesheet" href="https://hugo.gavriliu.com/css/fonts.min.5bb7ed13e1d00d8ff39ea84af26737007eb5051b157b86fc24487c94f3dc8bbe.css">

  
  <link rel="stylesheet" href="https://hugo.gavriliu.com/css/footer.min.eb8dfc2c6a7eafa36cd3ba92d63e69e849e2200e0002a228d137f236b09ecd75.css">

  
  <link rel="stylesheet" href="https://hugo.gavriliu.com/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css">

  
  <link rel="stylesheet" href="https://hugo.gavriliu.com/css/header.min.75c7eb0e2872d95ff48109c6647d0223a38db52e2561dd87966eb5fc7c6bdac6.css">

  
  <link rel="stylesheet" href="https://hugo.gavriliu.com/css/main.min.15870410d15d02abd22fb5ef00996f65a00d04b3a7435e9f83831c7c2298de88.css">

  
  <link rel="stylesheet" href="https://hugo.gavriliu.com/css/menu.min.3c17467ebeb3d38663dce68f71f519901124fa5cbb4519b2fb0667a21e9aca39.css">

  
  <link rel="stylesheet" href="https://hugo.gavriliu.com/css/pagination.min.bbb986dbce00a5ce5aca0504b7925fc1c581992a4bf57f163e5d69cc1db7d836.css">

  
  <link rel="stylesheet" href="https://hugo.gavriliu.com/css/post.min.e6dddd258e64c83e05cec0cd49c05216742d42fc8ecbfbe6b67083412b609bd3.css">

  
  <link rel="stylesheet" href="https://hugo.gavriliu.com/css/syntax.min.a0773cce9310cb6d8ed23e50f005448facf29a53001b57e038828daa466b25c0.css">

  
  <link rel="stylesheet" href="https://hugo.gavriliu.com/css/terminal.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css">

  
  <link rel="stylesheet" href="https://hugo.gavriliu.com/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css">







<link rel="shortcut icon" href="https://hugo.gavriliu.com/favicon.png">
<link rel="apple-touch-icon" href="https://hugo.gavriliu.com/apple-touch-icon.png">


<meta name="twitter:card" content="summary" />

  
    <meta name="twitter:site" content="" />
  
    <meta name="twitter:creator" content="" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Containers Not Mounting Longhorn Volumes">
<meta property="og:description" content="Shoutout to derekbit for saving my cluster from a tragic post-power-outage existential crisis. My entire homelab went down for a few hours, and Longhorn wasn’t exactly in a hurry to come back. More details on the saga can be found here and in this lifesaving comment.
Tools used stern: Stern allows you to tail multiple pods on Kubernetes and multiple containers within the pod. Each result is color coded for quicker debugging. Check the logs To start questioning your life choices, run:
" />
<meta property="og:url" content="https://hugo.gavriliu.com/posts/containers-not-mounting-longhorn-volumes/" />
<meta property="og:site_name" content="Terminal" />

  
  
  <meta property="og:image" content="https://hugo.gavriliu.com/">

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">


  <meta property="article:published_time" content="2025-03-14 21:34:29 &#43;0100 CET" />












</head>
<body>


<div class="container">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    Terminal
  </div>
</a>

    </div>
    
      <ul class="menu menu--mobile">
  <li class="menu__trigger">Menu&nbsp;▾</li>
  <li>
    <ul class="menu__dropdown">
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/showcase">Showcase</a></li>
        
      
      
    </ul>
  </li>
</ul>

    
    
  </div>
  
    <nav class="navigation-menu">
  <ul class="navigation-menu__inner menu--desktop">
    
      
        
          <li><a href="/about" >About</a></li>
        
      
        
          <li><a href="/showcase" >Showcase</a></li>
        
      
      
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="https://hugo.gavriliu.com/posts/containers-not-mounting-longhorn-volumes/">Containers Not Mounting Longhorn Volumes</a>
  </h1>
  <div class="post-meta"><time class="post-date">2025-03-14</time></div>

  
    <span class="post-tags">
      
      #<a href="https://hugo.gavriliu.com/tags/longhorn/">longhorn</a>&nbsp;
      
      #<a href="https://hugo.gavriliu.com/tags/troubleshooting/">troubleshooting</a>&nbsp;
      
    </span>
  
  


  

  <div class="post-content"><div>
        <p>Shoutout to <a href="https://github.com/derekbit">derekbit</a> for saving my cluster from a tragic post-power-outage existential crisis. My entire homelab went down for a few hours, and Longhorn wasn’t exactly in a hurry to come back. More details on the saga can be found <a href="https://github.com/longhorn/longhorn/issues/7183">here</a> and in this lifesaving <a href="https://github.com/longhorn/longhorn/issues/7183#issuecomment-1823715359">comment</a>.</p>
<h2 id="tools-used">Tools used<a href="#tools-used" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<ul>
<li><a href="https://github.com/stern/stern">stern</a>: Stern allows you to <code>tail</code> multiple pods on Kubernetes and multiple containers within the pod. Each result is color coded for quicker debugging.</li>
</ul>
<h2 id="check-the-logs">Check the logs<a href="#check-the-logs" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>To start questioning your life choices, run:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ stern -n longhorn-system longhorn-manager
</span></span></code></pre></div><p>This will flood your terminal with comforting messages like:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">longhorn-manager-brgwp longhorn-manager E0129 16:59:30.764472       <span class="m">1</span> share_manager_controller.go:254<span class="o">]</span> failed to sync longhorn-system/pvc-ca4a891c-cdc9-424e-949d-0ea016b80c84: pod share-manager-pvc-ca4a891c-cdc9-424e-949d-0ea016b80c84 <span class="k">for</span> share manager not found
</span></span><span class="line"><span class="cl">longhorn-manager-brgwp longhorn-manager <span class="nv">time</span><span class="o">=</span><span class="s2">&#34;2024-01-29T16:59:30Z&#34;</span> <span class="nv">level</span><span class="o">=</span>error <span class="nv">msg</span><span class="o">=</span><span class="s2">&#34;Dropping Longhorn share manager out of the queue&#34;</span> <span class="nv">func</span><span class="o">=</span>controller.handleReconcileErrorLogging <span class="nv">file</span><span class="o">=</span><span class="s2">&#34;utils.go:72&#34;</span> <span class="nv">ShareManager</span><span class="o">=</span>longhorn-system/pvc-7da9dfcf-a9b8-4995-ab1d-100a2a9ee72a <span class="nv">controller</span><span class="o">=</span>longhorn-share-manager <span class="nv">error</span><span class="o">=</span><span class="s2">&#34;failed to sync longhorn-system/pvc-7da9dfcf-a9b8-4995-ab1d-100a2a9ee72a: pod share-manager-pvc-7da9dfcf-a9b8-4995-ab1d-100a2a9ee72a for share manager not found&#34;</span> <span class="nv">node</span><span class="o">=</span>hive02
</span></span></code></pre></div><p>In short: Longhorn was not having a good day.</p>
<h2 id="apply-the-fix">Apply the fix<a href="#apply-the-fix" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>Borrowing from the wisdom of the Issue thread, I decided to take the nuclear option and reset all my volumes:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="k">for</span> lhsm in <span class="k">$(</span>kubectl -n longhorn-system get lhsm --no-headers <span class="p">|</span> awk <span class="s1">&#39;{ print $1 }&#39;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl"><span class="k">do</span>
</span></span><span class="line"><span class="cl">  kubectl -n longhorn-system patch lhsm <span class="nv">$lhsm</span> --type<span class="o">=</span>merge --subresource status --patch <span class="s1">&#39;status: {state: error}&#39;</span>
</span></span><span class="line"><span class="cl">  sleep <span class="m">30</span>
</span></span><span class="line"><span class="cl"><span class="k">done</span>
</span></span></code></pre></div><p>A few hours (and nervous sweats) later, everything was back to normal. No data loss, just a valuable lesson: <em>Power outages are the devil, and Longhorn likes to hold grudges.</em></p>

      </div></div>

  
    
<div class="pagination">
  <div class="pagination__title">
    <span class="pagination__title-h">Read other posts</span>
    <hr />
  </div>
  <div class="pagination__buttons">
    
      <a href="https://hugo.gavriliu.com/posts/waste-collection-schedule-in-ha/" class="button inline prev">
        &lt; [<span class="button__text">Waste Collection Schedule in HomeAssistant</span>]
      </a>
    
    
      ::
    
    
      <a href="https://hugo.gavriliu.com/posts/argocd-combine-helm-and-k8s-manifests-in-one-application/" class="button inline next">
         [<span class="button__text">Combine Helm and K8s Manifests in One ArgoCD Application</span>] &gt;
      </a>
    
  </div>
</div>


  

  
    

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2025 Powered by <a href="https://gohugo.io">Hugo</a></span>
    
      <span>:: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank">Theme</a> made by <a href="https://github.com/panr" target="_blank">panr</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>





  
</div>

</body>
</html>
